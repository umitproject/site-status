{% load media %}
{% load i18n %}
{% load status_tags %}
{% load user_tags %}
<!DOCTYPE HTML>
<html>
<head>
    <title></title>
    {% include_media 'main.js' %}
    {% include_media 'bootstrap.js' %}
    {% include_media 'bootstrap.css' %}
    <style>
        body, section {
            padding-top: 40px;
        }
    </style>
</head>
<body data-spy="scroll">
    <div id="main-container" class="container">
        <div class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <ul class="nav pull-left">
                        <li>
                            <a href="#profile"><i class="icon-white icon-user"></i> My Profile</a>
                        </li>
                        <li>
                            <a href="#monitors"><i class="icon-white icon-eye-open"></i> Monitors</a>
                        </li>
                    </ul>
                    <ul class="nav pull-right">
                        <li>
                        <p class="navbar-text">
                            <i class="icon-white icon-user"></i> {% get_full_name user %}
                        </p>
                        </li>
                        <li>
                            <a href="{% url auth_logout %}">Logout</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <section id="profile">
            <div class="page-header">
                <h1>My Profile</h1>
                <form method='post' action='/backend/update_profile'>{% csrf_token %}
                    <table>
                        {{  form.as_table }}
                    </table>
                    <button class="btn btn-primary" type="submit" name="Submit" value="update_profile" data-complete-text="Saved!">Save</button>
                </form>
            </div>
        </section>
        <section id="monitors">
            <div class="page-header">
                <h1>My Monitors</h1>
            </div>

        </section>
        <div style="height:1000px;"></div>
    </div>
    <script type="text/javascript">
        $("#navbar").scrollspy();
        $(".btn").button();


        $("form").live('submit', function(evt){
            var submit_to = $(this).attr("action"),
                $this = $(this),
                $submit_button = $(this.Submit),
                data = {};

            function get_form_object($form) {
                var data = {};
                $form.find('input').each(function(){
                    var $this = $(this);
                    data[$this.attr('name')] = $this.val();
                });
                return data;
            }

            data = get_form_object($this);

            $submit_button.button("loading");

            evt.preventDefault();

            $.post(submit_to,data,
                function(response){
                    console.log($submit_button);
                    console.log(response);
                    $submit_button.button("complete");

                    setTimeout(function() {
                        $submit_button.button("reset");
                    }, 2000);

                    if (response.hasOwnProperty('error') &&
                            response.hasOwnProperty('message')) {
                        for (var key in response.message) {
                            var $input = $this.find('input[name="'+key +'"]');
                            $input.parent().before("<p>"+ response.message[key] +"</p>");
                        }
                    }
                })
        });
    </script>
</body>
</html>